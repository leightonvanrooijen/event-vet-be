"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SelfReferenceChecker = void 0;
const Colour_1 = require("../Colour");
class SelfReferenceChecker {
    constructor() {
        this.seen = [];
    }
    recurse(context, value, fn) {
        const selfRef = this.seen.find(pair => pair.value === value);
        if (selfRef) {
            // Return the path to the referred to object
            throw Error(SelfReferenceChecker.colouredMessage(selfRef.context));
        }
        this.seen.push({ context, value });
        const result = fn();
        this.seen.pop();
        return result;
    }
    static colouredMessage(context) {
        return Colour_1.Colour.bg_magenta("self-reference: " + context);
    }
}
exports.SelfReferenceChecker = SelfReferenceChecker;
//# sourceMappingURL=SelfReferenceChecker.js.map